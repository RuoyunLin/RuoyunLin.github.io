<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Welcome to my blog.">
  <meta name="keywords" content="Data Analyst, Data Scientist, User Researcher, Quantitative Research, and Business Analyst">
  <meta name="author" content="Ruoyun Lin's Blog">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#f5f5f5">

  <!-- Twitter Tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Ruoyun Lin's Blog">
  <meta name="twitter:description" content="Welcome to my blog.">
  <meta name="twitter:image" content="https://RuoyunLin.github.io/img/leonids-logo.png">

  <!-- Open Graph Tags -->
  <meta property="og:type" content="blog">
  <meta property="og:url" content="https://RuoyunLin.github.io">
  <meta property="og:title" content="Ruoyun Lin's Blog">
  <meta property="og:description" content="Welcome to my blog.">
  <meta property="og:image" content="https://RuoyunLin.github.io/img/leonids-logo.png">
  <title>Ruoyun Lin's Blog</title>

  <!-- CSS files -->
  <link rel="stylesheet" href="https://RuoyunLin.github.io/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://RuoyunLin.github.io/css/main.css">

  <link rel="canonical" href="https://RuoyunLin.github.io/">
  <link rel="alternate" type="application/rss+xml" title="Ruoyun Lin's Blog" href="https://RuoyunLin.github.io /feed.xml " />

  <!-- Icons -->
  <!-- 16x16 -->
  <link rel="shortcut icon" href="https://RuoyunLin.github.io/favicon.ico">
  <!-- 32x32 -->
  <link rel="shortcut icon" href="https://RuoyunLin.github.io/favicon.png">
</head>


<body>
  <div class="row">
    <div class="col s12 m3">
      <div class="table cover">
        

<div class="cover-card table-cell table-middle">
  
  <img src="https://RuoyunLin.github.io/img/avatar.jpg" alt="" class="avatar">
  
  <a href="https://RuoyunLin.github.io/" class="author_name">Ruoyun Lin</a>
  <span class="author_job"> </span>
  <span class="author_bio mbm">A junior data scientist at trivago, Germany</span>
  <nav class="nav">
    <ul class="nav-list">
      <li class="nav-item">
        <a href="https://RuoyunLin.github.io/">home</a>
        <span>/</span>
      </li>
         
      <li class="nav-item">
        <a href="https://RuoyunLin.github.io/about/">About</a>
        
          <span>/</span>
        
      </li>
        
      <li class="nav-item">
        <a href="https://RuoyunLin.github.io/archive/">Archive</a>
        
          <span>/</span>
        
      </li>
          
      <li class="nav-item">
        <a href="https://RuoyunLin.github.io/categories/">Categories</a>
        
          <span>/</span>
        
      </li>
            
      <li class="nav-item">
        <a href="https://RuoyunLin.github.io/tags/">Tags</a>
        
          <span>/</span>
        
      </li>
           
    </ul>
  </nav>
  <script type="text/javascript">
  // based on http://stackoverflow.com/a/10300743/280842
  function gen_mail_to_link(hs, subject) {
    var lhs,rhs;
    var p = hs.split('@');
    lhs = p[0];
    rhs = p[1];
    document.write("<a class=\"social-link-item\" target=\"_blank\" href=\"mailto");
    document.write(":" + lhs + "@");
    document.write(rhs + "?subject=" + subject + "\"><i class=\"fa fa-fw fa-envelope\"></i><\/a>");
  }
</script>
<div class="social-links">
  <ul>
    
      <li>
      <script>gen_mail_to_link('ritalinruoyun@gmail.com', 'Hello from website');</script>
      </li>
    
    <li><a href="http://twitter.com/RuoyunLin" class="social-link-item" target="_blank"><i class="fa fa-fw fa-twitter"></i></a></li>
    
    
    
    
    
    
    <li><a href="http://github.com/RuoyunLin" class="social-link-item" target="_blank"><i class="fa fa-fw fa-github"></i></a></li>
    
    
    
    
    
    
    
    
    
    
    
    
  </ul>
</div>

</div>

      </div>
    </div>
    <div class="col s12 m9">
      <div class="post-listing">
        <hr />
<p>Hi, welcome to my personal blog! I am <a href="https://ruoyunlin.github.io/about">Ruoyun Lin</a>, a junior data scientist at trivago. This is an online place for me to keep some relatively random stuffs: thoughts and reflections on my life and work, and beyond.</p>

<hr />




<section class="post">
  <header class="post-header">
    <p class="post-meta">
      <span class="post-date">
        13 SEP 2020
      </span>
      
      •
      
        <a class="post-cat" href="https://RuoyunLin.github.io/categories/#Finance">Finance</a>
        
        <span>/</span>
        
      
        <a class="post-cat" href="https://RuoyunLin.github.io/categories/#Data Science">Data Science</a>
        
      
      
    </p>
    <h1>
      <a href="https://RuoyunLin.github.io/articles/2020-09/financial-analysis-in-python-2-backtest-dollar-cost-averaging-strategy-for-long-term-investment" class="post-title" title="Financial Analysis in Python #2: Backtest Dollar Cost Averaging Strategy for Long-term Investment">Financial Analysis in Python #2: Backtest Dollar Cost Averaging Strategy for Long-term Investment</a>
      
    </h1>

    

    </header>

    
    <div class="post-description">
      <p>
        <h1 id="introduction">Introduction</h1>

<p>In the last notebook, we already talked about how to visualize the return of a long term investment plan.</p>

<p>We made an assumption that the annual return rate is about 5%. How can we ensure that we can invest our savings properly so that we can have a 5% annual return?</p>

<p>In this notebook, we are going to use the historical data of SP500 to do some backtesting.</p>

<p>We will calculate the overall rate of return and the internal rate of return for two dollor cost averaging methods.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Import libraries
</span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="nn">pandas_datareader</span> <span class="kn">import</span> <span class="n">data</span> <span class="k">as</span> <span class="n">pdr</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s">'bmh'</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s">"ignore"</span><span class="p">)</span>
</code></pre></div></div>

<h1 id="a-peak-into-the-history">A peak into the history</h1>

<p>The first step here is to download data. I used a method introducted in a <a href="https://www.datacamp.com/community/tutorials/finance-python-trading">datacamp tutorial</a>.</p>

<p>The <a href="https://www.investopedia.com/terms/t/total_return_index.asp#:~:text=The%20total%20return%20index%20is,representation%20of%20the%20index's%20performance">total return index</a> of SP500 between 1988 and 2020 is used here.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Get historical data
</span><span class="n">startdate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1988</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">enddate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># SP 500 Total return index
</span><span class="n">SP</span> <span class="o">=</span> <span class="n">pdr</span><span class="o">.</span><span class="n">get_data_yahoo</span><span class="p">(</span><span class="s">'^SP500TR'</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">startdate</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">enddate</span><span class="p">)</span>

<span class="c1"># If you want to use the price index of SP500, you can use the ticker of '^GSPC'
# SP = pdr.get_data_yahoo('^GSPC', start=startdate, end=enddate)
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SP</span>
</code></pre></div></div>

<div>
<table style="margin-left:auto;margin-right:auto;width:80%" border="1" class="minimalistBlack">
  <thead>
    <tr style="text-align: right;">
      <th>Date</th>
      <th>High</th>
      <th>Low</th>
      <th>Open</th>
      <th>Close</th>
      <th>Volume</th>
      <th>Adj Close</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1988-01-04</th>
      <td>256.019989</td>
      <td>256.019989</td>
      <td>256.019989</td>
      <td>256.019989</td>
      <td>0</td>
      <td>256.019989</td>
    </tr>
    <tr>
      <th>1988-01-05</th>
      <td>258.769989</td>
      <td>258.769989</td>
      <td>258.769989</td>
      <td>258.769989</td>
      <td>0</td>
      <td>258.769989</td>
    </tr>
    <tr>
      <th>1988-01-06</th>
      <td>259.029999</td>
      <td>259.029999</td>
      <td>259.029999</td>
      <td>259.029999</td>
      <td>0</td>
      <td>259.029999</td>
    </tr>
    <tr>
      <th>1988-01-07</th>
      <td>261.209991</td>
      <td>261.209991</td>
      <td>261.209991</td>
      <td>261.209991</td>
      <td>0</td>
      <td>261.209991</td>
    </tr>
    <tr>
      <th>1988-01-08</th>
      <td>243.550003</td>
      <td>243.550003</td>
      <td>243.550003</td>
      <td>243.550003</td>
      <td>0</td>
      <td>243.550003</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2020-08-17</th>
      <td>6954.669922</td>
      <td>6937.540039</td>
      <td>6940.890137</td>
      <td>6943.220215</td>
      <td>0</td>
      <td>6943.220215</td>
    </tr>
    <tr>
      <th>2020-08-18</th>
      <td>6971.020020</td>
      <td>6920.080078</td>
      <td>6954.689941</td>
      <td>6960.299805</td>
      <td>0</td>
      <td>6960.299805</td>
    </tr>
    <tr>
      <th>2020-08-19</th>
      <td>6981.410156</td>
      <td>6920.370117</td>
      <td>6967.069824</td>
      <td>6930.799805</td>
      <td>0</td>
      <td>6930.799805</td>
    </tr>
    <tr>
      <th>2020-08-20</th>
      <td>6963.520020</td>
      <td>6889.850098</td>
      <td>6901.520020</td>
      <td>6952.919922</td>
      <td>0</td>
      <td>6952.919922</td>
    </tr>
    <tr>
      <th>2020-08-21</th>
      <td>6982.970215</td>
      <td>6941.000000</td>
      <td>6954.390137</td>
      <td>6977.270020</td>
      <td>0</td>
      <td>6977.270020</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Generate group by keys
</span><span class="n">SP</span><span class="p">[</span><span class="s">'date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">SP</span><span class="o">.</span><span class="n">index</span>
<span class="n">SP</span><span class="p">[</span><span class="s">'year'</span><span class="p">]</span> <span class="o">=</span> <span class="n">SP</span><span class="p">[</span><span class="s">'date'</span><span class="p">]</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">f</span><span class="s">'{d.year}'</span><span class="p">)</span>

<span class="c1"># Group by year, take the adjusted close price of the first business day in each year
</span><span class="n">df</span> <span class="o">=</span> <span class="n">SP</span><span class="p">[[</span><span class="s">'year'</span><span class="p">,</span> <span class="s">'Adj Close'</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'year'</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

<span class="c1"># Generate annual return
</span><span class="n">df</span><span class="p">[</span><span class="s">'return'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'Adj Close'</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>

<span class="c1"># Show annual return by the beginning of next year
</span><span class="n">df</span><span class="p">[</span><span class="s">'return_next_y'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'return'</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s">'return'</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">df</span>
</code></pre></div></div>

<div>
<table style="margin-left:auto;margin-right:auto;width:80%" border="1" class="minimalistBlack">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>Adj Close</th>
      <th>return_next_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1988</td>
      <td>256.019989</td>
      <td>0.115733</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1989</td>
      <td>285.649994</td>
      <td>0.351864</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1990</td>
      <td>386.160004</td>
      <td>-0.058836</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1991</td>
      <td>363.440002</td>
      <td>0.320273</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1992</td>
      <td>479.839996</td>
      <td>0.075358</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1993</td>
      <td>516.000000</td>
      <td>0.099031</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1994</td>
      <td>567.099976</td>
      <td>0.014848</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1995</td>
      <td>575.520020</td>
      <td>0.386954</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1996</td>
      <td>798.219971</td>
      <td>0.214014</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1997</td>
      <td>969.049988</td>
      <td>0.346721</td>
    </tr>
    <tr>
      <th>10</th>
      <td>1998</td>
      <td>1305.040039</td>
      <td>0.278520</td>
    </tr>
    <tr>
      <th>11</th>
      <td>1999</td>
      <td>1668.520020</td>
      <td>0.199932</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2000</td>
      <td>2002.109985</td>
      <td>-0.108011</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2001</td>
      <td>1785.859985</td>
      <td>-0.088109</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2002</td>
      <td>1628.510010</td>
      <td>-0.199778</td>
    </tr>
    <tr>
      <th>15</th>
      <td>2003</td>
      <td>1303.170044</td>
      <td>0.241626</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2004</td>
      <td>1618.050049</td>
      <td>0.103155</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2005</td>
      <td>1784.959961</td>
      <td>0.075072</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2006</td>
      <td>1918.959961</td>
      <td>0.138075</td>
    </tr>
    <tr>
      <th>19</th>
      <td>2007</td>
      <td>2183.919922</td>
      <td>0.040977</td>
    </tr>
    <tr>
      <th>20</th>
      <td>2008</td>
      <td>2273.409912</td>
      <td>-0.340563</td>
    </tr>
    <tr>
      <th>21</th>
      <td>2009</td>
      <td>1499.170044</td>
      <td>0.245396</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2010</td>
      <td>1867.060059</td>
      <td>0.145277</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2011</td>
      <td>2138.300049</td>
      <td>0.025300</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2012</td>
      <td>2192.399902</td>
      <td>0.171570</td>
    </tr>
    <tr>
      <th>25</th>
      <td>2013</td>
      <td>2568.550049</td>
      <td>0.279590</td>
    </tr>
    <tr>
      <th>26</th>
      <td>2014</td>
      <td>3286.689941</td>
      <td>0.146649</td>
    </tr>
    <tr>
      <th>27</th>
      <td>2015</td>
      <td>3768.679932</td>
      <td>-0.001244</td>
    </tr>
    <tr>
      <th>28</th>
      <td>2016</td>
      <td>3763.989990</td>
      <td>0.146411</td>
    </tr>
    <tr>
      <th>29</th>
      <td>2017</td>
      <td>4315.080078</td>
      <td>0.218119</td>
    </tr>
    <tr>
      <th>30</th>
      <td>2018</td>
      <td>5256.279785</td>
      <td>-0.050553</td>
    </tr>
    <tr>
      <th>31</th>
      <td>2019</td>
      <td>4990.560059</td>
      <td>0.324358</td>
    </tr>
    <tr>
      <th>32</th>
      <td>2020</td>
      <td>6609.290039</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Describe the annual return
</span><span class="n">df</span><span class="p">[</span><span class="s">'return_next_y'</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div></div>
<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>count    32.000000
mean      0.120554
std       0.169035
min      -0.340563
25%       0.022687
50%       0.141676
75%       0.242569
max       0.386954
Name: return_next_y, dtype: float64
</code></pre></div></div>

<p>When checking the annual return rate, the minimum value is  -34.1% and maximum value is 38.7%.
So we should not be panic if we see a drop of 30-40% in the total value in a certain year. Try to buy more in the dip, and the bull market will follow in 1-3 years.</p>

<h1 id="define-functions">Define functions</h1>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">calc_dollar_cost_averaging_return</span><span class="p">(</span><span class="n">df_dc</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">value_per_period</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> 
                                      <span class="n">increase_investment_per_period</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
                                      <span class="n">display_returns</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="s">"""
    This function calculates the overall rate of return and the internal rate of return of dollar cost averaging method. 
    :param df_dc: Original dataframe that contains the price at the beginning of each period
    :param value_per_period: Investment value per period
    :param increase_investment_per_period: Increase the investment by x each period
    :param display_returns: Whether to display return results or not
    :return: A dataframe that contains all the relevant info
    """</span>
    <span class="c1"># amount to invest each period
</span>    <span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s">'should_invest'</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_per_period</span>   
    <span class="c1"># total amount of investment after the investment this period
</span>    <span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s">'total_invest'</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_per_period</span>   
    <span class="c1"># the total value by the beginning of next period
</span>    <span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s">'total_value_next'</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_per_period</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s">'return_next_y'</span><span class="p">])</span>
    <span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s">'overall_return_next'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s">'total_value_next'</span><span class="p">]</span> <span class="o">/</span> <span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s">'total_invest'</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">df_dc</span><span class="o">.</span><span class="n">index</span><span class="p">)):</span>
        <span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'should_invest'</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_per_period</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">increase_investment_per_period</span><span class="p">)</span><span class="o">**</span><span class="n">i</span>
        <span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'total_invest'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">'total_invest'</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'should_invest'</span><span class="p">]</span>
        <span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'total_value_next'</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">'total_value_next'</span><span class="p">]</span> <span class="o">+</span> 
                                            <span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'should_invest'</span><span class="p">])</span> <span class="o">*</span>
                                            <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'return_next_y'</span><span class="p">])</span> 
                                           <span class="p">)</span>
        <span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'overall_return_next'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'total_value_next'</span><span class="p">]</span> <span class="o">/</span> <span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'total_invest'</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        
    <span class="k">if</span> <span class="n">display_returns</span><span class="p">:</span>
        
        <span class="c1"># Calculate overall return
</span>        <span class="n">overall_return</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df_dc</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'overall_return_next'</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"The overall return rate is {overall_return}</span><span class="si">%</span><span class="s">"</span><span class="p">)</span>

        <span class="c1"># Calculate IRR
</span>        <span class="n">cf</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">df_dc</span><span class="p">[</span><span class="s">'should_invest'</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">cf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df_dc</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'total_value_next'</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"The cash flow (the negative sign stands for investment):"</span><span class="p">)</span>
        <span class="n">display</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
        <span class="n">irr</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">irr</span><span class="p">(</span><span class="n">cf</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"The internal return rate (IRR) is {irr}</span><span class="si">% </span><span class="s">per period"</span><span class="p">)</span>
        
        <span class="c1"># Calculate CAGR
</span>        <span class="n">cagr</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="p">((</span><span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df_dc</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'total_value_next'</span><span class="p">]</span><span class="o">/</span>
                           <span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df_dc</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'total_invest'</span><span class="p">])</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_dc</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"The compound annual growth rate (CAGR) is {cagr}</span><span class="si">% </span><span class="s">per period"</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">df_dc</span>


<span class="k">def</span> <span class="nf">plot_changes</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                 <span class="n">y1</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">'total_invest'</span><span class="p">,</span> <span class="n">y2</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">'total_value_next'</span><span class="p">,</span>
                 <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">'period'</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">'value'</span><span class="p">,</span>
                 <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">'Visualize total investment and value each year'</span><span class="p">,</span>
                 <span class="n">target</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="s">"""
    This function visualizes the total investment and the total value of the investment plan across time
    :param df: A dataframe contains total investment and total value
    :param y1: Column name
    :param y2: Column name
    :param xlabel: X label
    :param ylabel: Y label
    :param title: Title of the graph
    :return: A plot
    """</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">y1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">y1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">y2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">y2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">target</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'target value'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">y1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<h1 id="plan-1-yearly-dollar-cost-averaging-buying-method">Plan 1: Yearly <a href="https://en.wikipedia.org/wiki/Dollar_cost_averaging">dollar cost averaging</a> buying method</h1>

<p>Imagine we were able to invest 1200 dollar per year into a SP500 index based ETF starting from 1988.</p>

<p>What’s the overall return after 32 years?</p>

<p>What’s the average annual return?</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df1</span> <span class="o">=</span> <span class="n">calc_dollar_cost_averaging_return</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">value_per_period</span><span class="o">=</span><span class="mi">1200</span><span class="p">)</span>
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The overall return rate is 580.19%
The cash flow (the negative sign stands for investment):



[-1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 261192.11446741945]


The internal return rate (IRR) is 9.92% per period
The compound annual growth rate (CAGR) is 6.17% per period
</code></pre></div></div>

<p>df1:</p>

<div>
<table style="margin-left:auto;margin-right:auto;width:80%" border="1" class="minimalistBlack">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>Adj Close</th>
      <th>return_next_y</th>
      <th>should_invest</th>
      <th>total_invest</th>
      <th>total_value_next</th>
      <th>overall_return_next</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1988</td>
      <td>256.019989</td>
      <td>0.115733</td>
      <td>1200.0</td>
      <td>1200.0</td>
      <td>1338.879804</td>
      <td>0.115733</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1989</td>
      <td>285.649994</td>
      <td>0.351864</td>
      <td>1200.0</td>
      <td>2400.0</td>
      <td>3432.220743</td>
      <td>0.430092</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1990</td>
      <td>386.160004</td>
      <td>-0.058836</td>
      <td>1200.0</td>
      <td>3600.0</td>
      <td>4359.680708</td>
      <td>0.211022</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1991</td>
      <td>363.440002</td>
      <td>0.320273</td>
      <td>1200.0</td>
      <td>4800.0</td>
      <td>7340.295930</td>
      <td>0.529228</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1992</td>
      <td>479.839996</td>
      <td>0.075358</td>
      <td>1200.0</td>
      <td>6000.0</td>
      <td>9183.879488</td>
      <td>0.530647</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1993</td>
      <td>516.000000</td>
      <td>0.099031</td>
      <td>1200.0</td>
      <td>7200.0</td>
      <td>11412.205047</td>
      <td>0.585028</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1994</td>
      <td>567.099976</td>
      <td>0.014848</td>
      <td>1200.0</td>
      <td>8400.0</td>
      <td>12799.465363</td>
      <td>0.523746</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1995</td>
      <td>575.520020</td>
      <td>0.386954</td>
      <td>1200.0</td>
      <td>9600.0</td>
      <td>19416.618801</td>
      <td>1.022564</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1996</td>
      <td>798.219971</td>
      <td>0.214014</td>
      <td>1200.0</td>
      <td>10800.0</td>
      <td>25028.857872</td>
      <td>1.317487</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1997</td>
      <td>969.049988</td>
      <td>0.346721</td>
      <td>1200.0</td>
      <td>12000.0</td>
      <td>35322.955610</td>
      <td>1.943580</td>
    </tr>
    <tr>
      <th>10</th>
      <td>1998</td>
      <td>1305.040039</td>
      <td>0.278520</td>
      <td>1200.0</td>
      <td>13200.0</td>
      <td>46695.335609</td>
      <td>2.537525</td>
    </tr>
    <tr>
      <th>11</th>
      <td>1999</td>
      <td>1668.520020</td>
      <td>0.199932</td>
      <td>1200.0</td>
      <td>14400.0</td>
      <td>57471.129235</td>
      <td>2.991051</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2000</td>
      <td>2002.109985</td>
      <td>-0.108011</td>
      <td>1200.0</td>
      <td>15600.0</td>
      <td>52333.999013</td>
      <td>2.354744</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2001</td>
      <td>1785.859985</td>
      <td>-0.088109</td>
      <td>1200.0</td>
      <td>16800.0</td>
      <td>48817.182741</td>
      <td>1.905785</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2002</td>
      <td>1628.510010</td>
      <td>-0.199778</td>
      <td>1200.0</td>
      <td>18000.0</td>
      <td>40024.865577</td>
      <td>1.223604</td>
    </tr>
    <tr>
      <th>15</th>
      <td>2003</td>
      <td>1303.170044</td>
      <td>0.241626</td>
      <td>1200.0</td>
      <td>19200.0</td>
      <td>51185.872534</td>
      <td>1.665931</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2004</td>
      <td>1618.050049</td>
      <td>0.103155</td>
      <td>1200.0</td>
      <td>20400.0</td>
      <td>57789.735898</td>
      <td>1.832830</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2005</td>
      <td>1784.959961</td>
      <td>0.075072</td>
      <td>1200.0</td>
      <td>21600.0</td>
      <td>63418.196358</td>
      <td>1.936028</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2006</td>
      <td>1918.959961</td>
      <td>0.138075</td>
      <td>1200.0</td>
      <td>22800.0</td>
      <td>73540.339150</td>
      <td>2.225453</td>
    </tr>
    <tr>
      <th>19</th>
      <td>2007</td>
      <td>2183.919922</td>
      <td>0.040977</td>
      <td>1200.0</td>
      <td>24000.0</td>
      <td>77802.957039</td>
      <td>2.241790</td>
    </tr>
    <tr>
      <th>20</th>
      <td>2008</td>
      <td>2273.409912</td>
      <td>-0.340563</td>
      <td>1200.0</td>
      <td>25200.0</td>
      <td>52097.453233</td>
      <td>1.067359</td>
    </tr>
    <tr>
      <th>21</th>
      <td>2009</td>
      <td>1499.170044</td>
      <td>0.245396</td>
      <td>1200.0</td>
      <td>26400.0</td>
      <td>66376.423781</td>
      <td>1.514258</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2010</td>
      <td>1867.060059</td>
      <td>0.145277</td>
      <td>1200.0</td>
      <td>27600.0</td>
      <td>77393.691544</td>
      <td>1.804119</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2011</td>
      <td>2138.300049</td>
      <td>0.025300</td>
      <td>1200.0</td>
      <td>28800.0</td>
      <td>80582.143634</td>
      <td>1.797991</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2012</td>
      <td>2192.399902</td>
      <td>0.171570</td>
      <td>1200.0</td>
      <td>30000.0</td>
      <td>95813.509570</td>
      <td>2.193784</td>
    </tr>
    <tr>
      <th>25</th>
      <td>2013</td>
      <td>2568.550049</td>
      <td>0.279590</td>
      <td>1200.0</td>
      <td>31200.0</td>
      <td>124137.478352</td>
      <td>2.978765</td>
    </tr>
    <tr>
      <th>26</th>
      <td>2014</td>
      <td>3286.689941</td>
      <td>0.146649</td>
      <td>1200.0</td>
      <td>32400.0</td>
      <td>143718.101728</td>
      <td>3.435744</td>
    </tr>
    <tr>
      <th>27</th>
      <td>2015</td>
      <td>3768.679932</td>
      <td>-0.001244</td>
      <td>1200.0</td>
      <td>33600.0</td>
      <td>144737.758102</td>
      <td>3.307671</td>
    </tr>
    <tr>
      <th>28</th>
      <td>2016</td>
      <td>3763.989990</td>
      <td>0.146411</td>
      <td>1200.0</td>
      <td>34800.0</td>
      <td>167304.672506</td>
      <td>3.807606</td>
    </tr>
    <tr>
      <th>29</th>
      <td>2017</td>
      <td>4315.080078</td>
      <td>0.218119</td>
      <td>1200.0</td>
      <td>36000.0</td>
      <td>205258.694569</td>
      <td>4.701630</td>
    </tr>
    <tr>
      <th>30</th>
      <td>2018</td>
      <td>5256.279785</td>
      <td>-0.050553</td>
      <td>1200.0</td>
      <td>37200.0</td>
      <td>196021.626888</td>
      <td>4.269399</td>
    </tr>
    <tr>
      <th>31</th>
      <td>2019</td>
      <td>4990.560059</td>
      <td>0.324358</td>
      <td>1200.0</td>
      <td>38400.0</td>
      <td>261192.114467</td>
      <td>5.801878</td>
    </tr>
    <tr>
      <th>32</th>
      <td>2020</td>
      <td>6609.290039</td>
      <td>NaN</td>
      <td>1200.0</td>
      <td>39600.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_changes</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">'Plan 1'</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s">'year'</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/asserts/3_output_14_0.png" alt="png" title="Plan 1" width="80%" /></p>

<h1 id="plan-2-increase-the-investment-each-year-by-2">Plan 2: Increase the investment each year by 2%</h1>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Assuming initial_investment is 1200, and then increase investment each year by 2%
</span><span class="n">df2</span> <span class="o">=</span> <span class="n">calc_dollar_cost_averaging_return</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">value_per_period</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">increase_investment_per_period</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
</code></pre></div></div>
<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The overall return rate is 486.51%
The cash flow (the negative sign stands for investment):



[-1200.0,
 -1224.0,
 -1248.48,
 -1273.4496000000001,
 -1298.918592,
 -1324.8969638400001,
 -1351.3949031168002,
 -1378.422801179136,
 -1405.991257202719,
 -1434.1110823467732,
 -1462.7933039937088,
 -1492.049170073583,
 -1521.8901534750546,
 -1552.327956544556,
 -1583.374515675447,
 -1615.042005988956,
 -1647.3428461087349,
 -1680.2897030309098,
 -1713.8954970915281,
 -1748.1734070333584,
 -1783.1368751740258,
 -1818.7996126775063,
 -1855.1756049310566,
 -1892.2791170296778,
 -1930.1246993702714,
 -1968.7271933576767,
 -2008.1017372248302,
 -2048.263771969327,
 -2089.2290474087135,
 -2131.0136283568877,
 -2173.633900924026,
 -2217.106578942506,
 311273.63335198513]


The internal return rate (IRR) is 9.91% per period
The compound annual growth rate (CAGR) is 5.68% per period
</code></pre></div></div>

<p>df2:</p>

<div>
<table style="margin-left:auto;margin-right:auto;width:80%" border="1" class="minimalistBlack">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>Adj Close</th>
      <th>return_next_y</th>
      <th>should_invest</th>
      <th>total_invest</th>
      <th>total_value_next</th>
      <th>overall_return_next</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1988</td>
      <td>256.019989</td>
      <td>0.115733</td>
      <td>1200.000000</td>
      <td>1200.000000</td>
      <td>1338.879804</td>
      <td>0.115733</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1989</td>
      <td>285.649994</td>
      <td>0.351864</td>
      <td>1224.000000</td>
      <td>2424.000000</td>
      <td>3464.665484</td>
      <td>0.429317</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1990</td>
      <td>386.160004</td>
      <td>-0.058836</td>
      <td>1248.480000</td>
      <td>3672.480000</td>
      <td>4435.844184</td>
      <td>0.207861</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1991</td>
      <td>363.440002</td>
      <td>0.320273</td>
      <td>1273.449600</td>
      <td>4945.929600</td>
      <td>7537.826024</td>
      <td>0.524046</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1992</td>
      <td>479.839996</td>
      <td>0.075358</td>
      <td>1298.918592</td>
      <td>6244.848192</td>
      <td>9502.668090</td>
      <td>0.521681</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1993</td>
      <td>516.000000</td>
      <td>0.099031</td>
      <td>1324.896964</td>
      <td>7569.745156</td>
      <td>11899.829221</td>
      <td>0.572025</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1994</td>
      <td>567.099976</td>
      <td>0.014848</td>
      <td>1351.394903</td>
      <td>8921.140059</td>
      <td>13447.972306</td>
      <td>0.507428</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1995</td>
      <td>575.520020</td>
      <td>0.386954</td>
      <td>1378.422801</td>
      <td>10299.562860</td>
      <td>20563.532573</td>
      <td>0.996544</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1996</td>
      <td>798.219971</td>
      <td>0.214014</td>
      <td>1405.991257</td>
      <td>11705.554117</td>
      <td>26671.303126</td>
      <td>1.278517</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1997</td>
      <td>969.049988</td>
      <td>0.346721</td>
      <td>1434.111082</td>
      <td>13139.665200</td>
      <td>37850.153571</td>
      <td>1.880603</td>
    </tr>
    <tr>
      <th>10</th>
      <td>1998</td>
      <td>1305.040039</td>
      <td>0.278520</td>
      <td>1462.793304</td>
      <td>14602.458504</td>
      <td>50262.395731</td>
      <td>2.442050</td>
    </tr>
    <tr>
      <th>11</th>
      <td>1999</td>
      <td>1668.520020</td>
      <td>0.199932</td>
      <td>1492.049170</td>
      <td>16094.507674</td>
      <td>62101.796628</td>
      <td>2.858571</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2000</td>
      <td>2002.109985</td>
      <td>-0.108011</td>
      <td>1521.890153</td>
      <td>17616.397827</td>
      <td>56751.625622</td>
      <td>2.221523</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2001</td>
      <td>1785.859985</td>
      <td>-0.088109</td>
      <td>1552.327957</td>
      <td>19168.725784</td>
      <td>53166.862347</td>
      <td>1.773625</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2002</td>
      <td>1628.510010</td>
      <td>-0.199778</td>
      <td>1583.374516</td>
      <td>20752.100299</td>
      <td>43812.361085</td>
      <td>1.111225</td>
    </tr>
    <tr>
      <th>15</th>
      <td>2003</td>
      <td>1303.170044</td>
      <td>0.241626</td>
      <td>1615.042006</td>
      <td>22367.142305</td>
      <td>56403.853151</td>
      <td>1.521728</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2004</td>
      <td>1618.050049</td>
      <td>0.103155</td>
      <td>1647.342846</td>
      <td>24014.485152</td>
      <td>64039.465661</td>
      <td>1.666702</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2005</td>
      <td>1784.959961</td>
      <td>0.075072</td>
      <td>1680.289703</td>
      <td>25694.774855</td>
      <td>70653.449907</td>
      <td>1.749721</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2006</td>
      <td>1918.959961</td>
      <td>0.138075</td>
      <td>1713.895497</td>
      <td>27408.670352</td>
      <td>82359.450191</td>
      <td>2.004869</td>
    </tr>
    <tr>
      <th>19</th>
      <td>2007</td>
      <td>2183.919922</td>
      <td>0.040977</td>
      <td>1748.173407</td>
      <td>29156.843759</td>
      <td>87554.082572</td>
      <td>2.002866</td>
    </tr>
    <tr>
      <th>20</th>
      <td>2008</td>
      <td>2273.409912</td>
      <td>-0.340563</td>
      <td>1783.136875</td>
      <td>30939.980634</td>
      <td>58912.245650</td>
      <td>0.904082</td>
    </tr>
    <tr>
      <th>21</th>
      <td>2009</td>
      <td>1499.170044</td>
      <td>0.245396</td>
      <td>1818.799613</td>
      <td>32758.780247</td>
      <td>75634.187986</td>
      <td>1.308822</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2010</td>
      <td>1867.060059</td>
      <td>0.145277</td>
      <td>1855.175605</td>
      <td>34613.955851</td>
      <td>88746.748765</td>
      <td>1.563901</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2011</td>
      <td>2138.300049</td>
      <td>0.025300</td>
      <td>1892.279117</td>
      <td>36506.234969</td>
      <td>92932.231838</td>
      <td>1.545654</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2012</td>
      <td>2192.399902</td>
      <td>0.171570</td>
      <td>1930.124699</td>
      <td>38436.359668</td>
      <td>111137.895169</td>
      <td>1.891478</td>
    </tr>
    <tr>
      <th>25</th>
      <td>2013</td>
      <td>2568.550049</td>
      <td>0.279590</td>
      <td>1968.727193</td>
      <td>40405.086861</td>
      <td>144730.058188</td>
      <td>2.581976</td>
    </tr>
    <tr>
      <th>26</th>
      <td>2014</td>
      <td>3286.689941</td>
      <td>0.146649</td>
      <td>2008.101737</td>
      <td>42413.188598</td>
      <td>168257.173136</td>
      <td>2.967096</td>
    </tr>
    <tr>
      <th>27</th>
      <td>2015</td>
      <td>3768.679932</td>
      <td>-0.001244</td>
      <td>2048.263772</td>
      <td>44461.452370</td>
      <td>170093.499961</td>
      <td>2.825640</td>
    </tr>
    <tr>
      <th>28</th>
      <td>2016</td>
      <td>3763.989990</td>
      <td>0.146411</td>
      <td>2089.229047</td>
      <td>46550.681418</td>
      <td>197392.199679</td>
      <td>3.240372</td>
    </tr>
    <tr>
      <th>29</th>
      <td>2017</td>
      <td>4315.080078</td>
      <td>0.218119</td>
      <td>2131.013628</td>
      <td>48681.695046</td>
      <td>243042.959525</td>
      <td>3.992492</td>
    </tr>
    <tr>
      <th>30</th>
      <td>2018</td>
      <td>5256.279785</td>
      <td>-0.050553</td>
      <td>2173.633901</td>
      <td>50855.328947</td>
      <td>232820.204951</td>
      <td>3.578089</td>
    </tr>
    <tr>
      <th>31</th>
      <td>2019</td>
      <td>4990.560059</td>
      <td>0.324358</td>
      <td>2217.106579</td>
      <td>53072.435526</td>
      <td>311273.633352</td>
      <td>4.865072</td>
    </tr>
    <tr>
      <th>32</th>
      <td>2020</td>
      <td>6609.290039</td>
      <td>NaN</td>
      <td>2261.448711</td>
      <td>55333.884237</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_changes</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">'Plan 2'</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s">'year'</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/asserts/3_output_18_0.png" alt="png" title="Plan 2" width="80%" /></p>

<h1 id="conclusion">Conclusion</h1>

<p>The compound annual growth rate of Plan 2 is lower than that of Plan 1. This is because Plan 2 invested more money at the later stage of the investment. But, in both plans, the compound annual growth rates are more than 5%.</p>

<p>The internal return rate of both plans are quite similiar to each other (almost 10%).</p>

<p>It seems that SP500 is a good enough index that can bring us long term return. However, the historical data cannot predict the future. Please do your own research before investing.</p>

<p>In the next notebook, we will further discuss which strategy can further increase IRR.</p>


      </p>
    </div>
    

    

</section>

<section class="post">
  <header class="post-header">
    <p class="post-meta">
      <span class="post-date">
        6 SEP 2020
      </span>
      
      •
      
        <a class="post-cat" href="https://RuoyunLin.github.io/categories/#Finance">Finance</a>
        
        <span>/</span>
        
      
        <a class="post-cat" href="https://RuoyunLin.github.io/categories/#Data Science">Data Science</a>
        
      
      
    </p>
    <h1>
      <a href="https://RuoyunLin.github.io/articles/2020-09/financial-analysis-in-python-1-how-to-visualize-long-term-investment-plan" class="post-title" title="Financial Analysis in Python #1: How to Visualize Long Term Investment Plan">Financial Analysis in Python #1: How to Visualize Long Term Investment Plan</a>
      
    </h1>

    

    </header>

    
    <div class="post-description">
      <p>
        <h1 id="overview">Overview</h1>

<p>It is always important to learn how to invest your money properly so that you do not need to worry about money after retirement.</p>

<p>Starting from this blog post, I am going to share how I used python to set up my own investment plan.</p>

<p>I will try to cover a few topics like:</p>

<ul>
  <li>how to visualize the long term investment plan</li>
  <li>backtest dollar cost averaging strategy for long-term investment</li>
  <li>backtest value average investment strategy for long-term investment</li>
  <li>compare different investment strategies for short term investment</li>
  <li>tbd…</li>
</ul>

<p>The jupyter notebooks can be downloaded <a href="https://github.com/RuoyunLin/code_snippets/tree/master/finance">here</a>.</p>

<h1 id="disclaimer">Disclaimer</h1>

<p>Investing money into anything is often involved with risk. Please do your own research before investing and be responsible for your own investment decisions.</p>

<p>I am just learning investment on my own and want to share some codes that I have written that might be useful for others.</p>

<p>The content here is only for informational purpose (instead of taking them as professional investment advice).</p>

<h1 id="introduction">Introduction</h1>

<p>This blogpost contains a function that helps you visualize your long term investment plan.</p>

<p>Step 1: Calculate how much savings do you have for now and estimate how much you can save per year</p>

<p>Step 2: Think about how much money do you need after retirement</p>

<ul>
  <li>
    <p>3,000 Euro/Month –&gt; 36,000 Euro/Year</p>
  </li>
  <li>
    <p>Assuming we can have 5% interest rate per year, then we need to accumulate at least 720,000 Euro before retirement (36,000/0.05 = 720,000)</p>
  </li>
  <li>
    <p>Please also note that, assuming the inflation rate of 3% per year, the buying power of 3000 Euro in 2050 might only worth 1235 Euro in 2020. Please adjust the inflation rate by yourself when estimating how much money do you need after retirement</p>
  </li>
</ul>

<p>Step 3: Estmiate (roughly) how much money do you need to invest per year and calculate it’s long term return</p>

<h2 id="define-functions">Define functions</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Import libraries
</span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s">'bmh'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">calc_return_over_periods</span><span class="p">(</span><span class="n">initial_investment</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">investment_per_period</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                             <span class="n">return_per_period</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">n_period</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                             <span class="n">increase_investment_per_period</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.00</span><span class="p">,</span>
                             <span class="n">invest_at_period_begin</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="s">"""
    This function calculates the overall rate of return across n periods given a certain return rate pre period
    :param initial_investment: Amount of initial investment
    :param investment_per_period: Amount of investment per period
    :param return_per_period: Assumed rate of return per period
    :param n_period: Total number of periods
    :param increase_investment_per_period: Increase the amount of investment by x for each period after the first investment period
    :param invest_at_period_begin: whether to invest at the begining of each period or not
    :return: dataframe contains the rate of return for n periods.
    """</span>
    <span class="n">df_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_period</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">invest_at_period_begin</span><span class="p">:</span>
                <span class="n">period_begin_investment</span> <span class="o">=</span> <span class="n">initial_investment</span> <span class="o">+</span> <span class="n">investment_per_period</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">invest_at_period_begin</span><span class="p">:</span>
                <span class="n">period_begin_investment</span> <span class="o">=</span> <span class="n">initial_investment</span>
            <span class="n">df_result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'period_begin_investment'</span><span class="p">]</span> <span class="o">=</span> <span class="n">period_begin_investment</span>
            <span class="n">df_result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'total_investment'</span><span class="p">]</span> <span class="o">=</span> <span class="n">period_begin_investment</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">period_begin_investment</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">return_per_period</span><span class="p">)</span>
            <span class="n">df_result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'value_by_next_period'</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">invest_at_period_begin</span><span class="p">:</span>
                <span class="n">period_begin_investment</span> <span class="o">=</span> <span class="n">investment_per_period</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">increase_investment_per_period</span><span class="p">)</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">invest_at_period_begin</span><span class="p">:</span>
                <span class="n">period_begin_investment</span> <span class="o">=</span> <span class="n">investment_per_period</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">increase_investment_per_period</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">value</span> <span class="o">+=</span> <span class="n">period_begin_investment</span>
            <span class="n">df_result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'period_begin_investment'</span><span class="p">]</span> <span class="o">=</span> <span class="n">period_begin_investment</span>
            <span class="n">df_result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'total_investment'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'total_investment'</span><span class="p">]</span> <span class="o">+</span>
                                                    <span class="n">df_result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'period_begin_investment'</span><span class="p">])</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">return_per_period</span><span class="p">)</span>
            <span class="n">df_result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'value_by_next_period'</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="n">df_result</span><span class="p">[</span><span class="s">'return_by_next_period'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_result</span><span class="p">[</span><span class="s">'value_by_next_period'</span><span class="p">]</span> <span class="o">/</span> <span class="n">df_result</span><span class="p">[</span><span class="s">'total_investment'</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">df_result</span><span class="o">.</span><span class="nb">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plot_changes</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                 <span class="n">y1</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">'total_investment'</span><span class="p">,</span> <span class="n">y2</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">'value_by_next_period'</span><span class="p">,</span>
                 <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">'period'</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">'value'</span><span class="p">,</span>
                 <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">'Visualize your saving plan and its future value'</span><span class="p">,</span>
                 <span class="n">target</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="s">"""
    This function visualizes the total investment and the total value of the investment plan across time
    :param df: A dataframe contains total investment and total value
    :param y1: Column name
    :param y2: Column name
    :param xlabel: X label
    :param ylabel: Y label
    :param title: Title of the graph
    :param target: Final value one wants to achieve
    :return: A plot
    """</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">y1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">y1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">y2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">y2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">target</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'target value'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">y1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="case-1">Case 1</h2>

<p>Imagine that you are around 30 years old and have some savings (e.g., 20k Euro), and you are determined to invest 10000 Euro each year in order to have enough money for your retirement.</p>

<p>If you invest your savings into a ETF (e.g., SP500), you are likely to get about 5% annual return on average.</p>

<p>If everything works well, you want to retire around 60, so about 30 years to go!</p>

<p>Let’s use the function above to check if we can have enough money saved for retirement in this case.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Each period is a year
</span>
<span class="c1"># Assuming investing 20000 Euro initially 
</span><span class="n">initial_investment</span> <span class="o">=</span> <span class="mi">20000</span>

<span class="c1"># Assuming investing 10000 Euro in the begining of each year
</span><span class="n">investment_per_period</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="c1"># Assuming the average investment return rate is about 5%
</span><span class="n">return_per_period</span> <span class="o">=</span> <span class="mf">0.05</span>

<span class="c1"># Assuming the plan lasts for 30 years
</span><span class="n">n_period</span> <span class="o">=</span> <span class="mi">30</span>

<span class="n">df_plan1</span> <span class="o">=</span> <span class="n">calc_return_over_periods</span><span class="p">(</span><span class="n">initial_investment</span><span class="p">,</span> <span class="n">investment_per_period</span><span class="p">,</span> 
                                   <span class="n">return_per_period</span><span class="p">,</span> <span class="n">n_period</span><span class="p">)</span>
<span class="n">df_plan1</span>
</code></pre></div></div>

<div>
<table style="margin-left:auto;margin-right:auto;width:80%" border="1" class="minimalistBlack">
  <thead>
    <tr>
      <th></th>
      <th>period_begin_investment</th>
      <th>total_investment</th>
      <th>value_by_next_period</th>
      <th>return_by_next_period</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>30000.0</td>
      <td>30000.0</td>
      <td>31500.00</td>
      <td>0.05</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10000.0</td>
      <td>40000.0</td>
      <td>43575.00</td>
      <td>0.09</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10000.0</td>
      <td>50000.0</td>
      <td>56253.75</td>
      <td>0.13</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10000.0</td>
      <td>60000.0</td>
      <td>69566.44</td>
      <td>0.16</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10000.0</td>
      <td>70000.0</td>
      <td>83544.76</td>
      <td>0.19</td>
    </tr>
    <tr>
      <th>5</th>
      <td>10000.0</td>
      <td>80000.0</td>
      <td>98222.00</td>
      <td>0.23</td>
    </tr>
    <tr>
      <th>6</th>
      <td>10000.0</td>
      <td>90000.0</td>
      <td>113633.10</td>
      <td>0.26</td>
    </tr>
    <tr>
      <th>7</th>
      <td>10000.0</td>
      <td>100000.0</td>
      <td>129814.75</td>
      <td>0.30</td>
    </tr>
    <tr>
      <th>8</th>
      <td>10000.0</td>
      <td>110000.0</td>
      <td>146805.49</td>
      <td>0.33</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10000.0</td>
      <td>120000.0</td>
      <td>164645.76</td>
      <td>0.37</td>
    </tr>
    <tr>
      <th>10</th>
      <td>10000.0</td>
      <td>130000.0</td>
      <td>183378.05</td>
      <td>0.41</td>
    </tr>
    <tr>
      <th>11</th>
      <td>10000.0</td>
      <td>140000.0</td>
      <td>203046.95</td>
      <td>0.45</td>
    </tr>
    <tr>
      <th>12</th>
      <td>10000.0</td>
      <td>150000.0</td>
      <td>223699.30</td>
      <td>0.49</td>
    </tr>
    <tr>
      <th>13</th>
      <td>10000.0</td>
      <td>160000.0</td>
      <td>245384.27</td>
      <td>0.53</td>
    </tr>
    <tr>
      <th>14</th>
      <td>10000.0</td>
      <td>170000.0</td>
      <td>268153.48</td>
      <td>0.58</td>
    </tr>
    <tr>
      <th>15</th>
      <td>10000.0</td>
      <td>180000.0</td>
      <td>292061.16</td>
      <td>0.62</td>
    </tr>
    <tr>
      <th>16</th>
      <td>10000.0</td>
      <td>190000.0</td>
      <td>317164.21</td>
      <td>0.67</td>
    </tr>
    <tr>
      <th>17</th>
      <td>10000.0</td>
      <td>200000.0</td>
      <td>343522.42</td>
      <td>0.72</td>
    </tr>
    <tr>
      <th>18</th>
      <td>10000.0</td>
      <td>210000.0</td>
      <td>371198.54</td>
      <td>0.77</td>
    </tr>
    <tr>
      <th>19</th>
      <td>10000.0</td>
      <td>220000.0</td>
      <td>400258.47</td>
      <td>0.82</td>
    </tr>
    <tr>
      <th>20</th>
      <td>10000.0</td>
      <td>230000.0</td>
      <td>430771.40</td>
      <td>0.87</td>
    </tr>
    <tr>
      <th>21</th>
      <td>10000.0</td>
      <td>240000.0</td>
      <td>462809.97</td>
      <td>0.93</td>
    </tr>
    <tr>
      <th>22</th>
      <td>10000.0</td>
      <td>250000.0</td>
      <td>496450.46</td>
      <td>0.99</td>
    </tr>
    <tr>
      <th>23</th>
      <td>10000.0</td>
      <td>260000.0</td>
      <td>531772.99</td>
      <td>1.05</td>
    </tr>
    <tr>
      <th>24</th>
      <td>10000.0</td>
      <td>270000.0</td>
      <td>568861.64</td>
      <td>1.11</td>
    </tr>
    <tr>
      <th>25</th>
      <td>10000.0</td>
      <td>280000.0</td>
      <td>607804.72</td>
      <td>1.17</td>
    </tr>
    <tr>
      <th>26</th>
      <td>10000.0</td>
      <td>290000.0</td>
      <td>648694.95</td>
      <td>1.24</td>
    </tr>
    <tr>
      <th>27</th>
      <td>10000.0</td>
      <td>300000.0</td>
      <td>691629.70</td>
      <td>1.31</td>
    </tr>
    <tr>
      <th>28</th>
      <td>10000.0</td>
      <td>310000.0</td>
      <td>736711.19</td>
      <td>1.38</td>
    </tr>
    <tr>
      <th>29</th>
      <td>10000.0</td>
      <td>320000.0</td>
      <td>784046.75</td>
      <td>1.45</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">target_value</span> <span class="o">=</span> <span class="mi">720000</span>

<span class="n">plot_changes</span><span class="p">(</span><span class="n">df_plan1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">'Case 1'</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">target_value</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s">'year'</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/2_output_7_0.png" alt="png" title="Case 1" width="80%" /></p>

<p>Conguraturations! It seems that if you just stick to this plan, you will have enough money for your retirement.</p>

<h2 id="case-2">Case 2</h2>

<p>Due to inflation and the increase of your salary, you might decided to save 2% more each year, let’s check how that is going to change the final value</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Each period is a year
</span>
<span class="c1"># Assuming investing 20000 Euro initially 
</span><span class="n">initial_investment</span> <span class="o">=</span> <span class="mi">20000</span>

<span class="c1"># Assuming investing 10000 Euro in the begining of each year
</span><span class="n">investment_per_period</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="c1"># Assuming the average investment return rate is about 5%
</span><span class="n">return_per_period</span> <span class="o">=</span> <span class="mf">0.05</span>

<span class="c1"># Assuming the plan lasts for 30 years
</span><span class="n">n_period</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1"># Assuming increase the amount of investment each year by 2%
</span><span class="n">increase_investment_per_period</span> <span class="o">=</span> <span class="mf">0.02</span>

<span class="n">df_plan2</span> <span class="o">=</span> <span class="n">calc_return_over_periods</span><span class="p">(</span><span class="n">initial_investment</span><span class="p">,</span> <span class="n">investment_per_period</span><span class="p">,</span> 
                                   <span class="n">return_per_period</span><span class="p">,</span> <span class="n">n_period</span><span class="p">,</span>
                                   <span class="n">increase_investment_per_period</span><span class="p">)</span>

<span class="n">df_plan2</span>
</code></pre></div></div>

<div>
<table style="margin-left:auto;margin-right:auto;width:80%" border="1" class="minimalistBlack">
  <thead>
    <tr>
      <th></th>
      <th>period_begin_investment</th>
      <th>total_investment</th>
      <th>value_by_next_period</th>
      <th>return_by_next_period</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>30000.00</td>
      <td>30000.00</td>
      <td>31500.00</td>
      <td>0.05</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10200.00</td>
      <td>40200.00</td>
      <td>43785.00</td>
      <td>0.09</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10404.00</td>
      <td>50604.00</td>
      <td>56898.45</td>
      <td>0.12</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10612.08</td>
      <td>61216.08</td>
      <td>70886.06</td>
      <td>0.16</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10824.32</td>
      <td>72040.40</td>
      <td>85795.90</td>
      <td>0.19</td>
    </tr>
    <tr>
      <th>5</th>
      <td>11040.81</td>
      <td>83081.21</td>
      <td>101678.54</td>
      <td>0.22</td>
    </tr>
    <tr>
      <th>6</th>
      <td>11261.62</td>
      <td>94342.83</td>
      <td>118587.17</td>
      <td>0.26</td>
    </tr>
    <tr>
      <th>7</th>
      <td>11486.86</td>
      <td>105829.69</td>
      <td>136577.73</td>
      <td>0.29</td>
    </tr>
    <tr>
      <th>8</th>
      <td>11716.59</td>
      <td>117546.28</td>
      <td>155709.04</td>
      <td>0.32</td>
    </tr>
    <tr>
      <th>9</th>
      <td>11950.93</td>
      <td>129497.21</td>
      <td>176042.96</td>
      <td>0.36</td>
    </tr>
    <tr>
      <th>10</th>
      <td>12189.94</td>
      <td>141687.15</td>
      <td>197644.55</td>
      <td>0.39</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12433.74</td>
      <td>154120.90</td>
      <td>220582.21</td>
      <td>0.43</td>
    </tr>
    <tr>
      <th>12</th>
      <td>12682.42</td>
      <td>166803.32</td>
      <td>244927.86</td>
      <td>0.47</td>
    </tr>
    <tr>
      <th>13</th>
      <td>12936.07</td>
      <td>179739.38</td>
      <td>270757.12</td>
      <td>0.51</td>
    </tr>
    <tr>
      <th>14</th>
      <td>13194.79</td>
      <td>192934.17</td>
      <td>298149.51</td>
      <td>0.55</td>
    </tr>
    <tr>
      <th>15</th>
      <td>13458.68</td>
      <td>206392.85</td>
      <td>327188.60</td>
      <td>0.59</td>
    </tr>
    <tr>
      <th>16</th>
      <td>13727.86</td>
      <td>220120.71</td>
      <td>357962.28</td>
      <td>0.63</td>
    </tr>
    <tr>
      <th>17</th>
      <td>14002.41</td>
      <td>234123.12</td>
      <td>390562.93</td>
      <td>0.67</td>
    </tr>
    <tr>
      <th>18</th>
      <td>14282.46</td>
      <td>248405.59</td>
      <td>425087.66</td>
      <td>0.71</td>
    </tr>
    <tr>
      <th>19</th>
      <td>14568.11</td>
      <td>262973.70</td>
      <td>461638.56</td>
      <td>0.76</td>
    </tr>
    <tr>
      <th>20</th>
      <td>14859.47</td>
      <td>277833.17</td>
      <td>500322.94</td>
      <td>0.80</td>
    </tr>
    <tr>
      <th>21</th>
      <td>15156.66</td>
      <td>292989.84</td>
      <td>541253.58</td>
      <td>0.85</td>
    </tr>
    <tr>
      <th>22</th>
      <td>15459.80</td>
      <td>308449.63</td>
      <td>584549.05</td>
      <td>0.90</td>
    </tr>
    <tr>
      <th>23</th>
      <td>15768.99</td>
      <td>324218.62</td>
      <td>630333.94</td>
      <td>0.94</td>
    </tr>
    <tr>
      <th>24</th>
      <td>16084.37</td>
      <td>340303.00</td>
      <td>678739.23</td>
      <td>0.99</td>
    </tr>
    <tr>
      <th>25</th>
      <td>16406.06</td>
      <td>356709.06</td>
      <td>729902.55</td>
      <td>1.05</td>
    </tr>
    <tr>
      <th>26</th>
      <td>16734.18</td>
      <td>373443.24</td>
      <td>783968.57</td>
      <td>1.10</td>
    </tr>
    <tr>
      <th>27</th>
      <td>17068.86</td>
      <td>390512.10</td>
      <td>841089.31</td>
      <td>1.15</td>
    </tr>
    <tr>
      <th>28</th>
      <td>17410.24</td>
      <td>407922.35</td>
      <td>901424.53</td>
      <td>1.21</td>
    </tr>
    <tr>
      <th>29</th>
      <td>17758.45</td>
      <td>425680.79</td>
      <td>965142.12</td>
      <td>1.27</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_changes</span><span class="p">(</span><span class="n">df_plan2</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">'Case 2'</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target_value</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s">'year'</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/2_output_11_0.png" alt="png" title="Case 2" width="80%" /></p>

<p>It seems that it only takes about 26 years instead of the 30 years in order to have enough savings for retirement. However, the return rate was reduced a bit due to the investment of more money at the later stage of this plan.</p>

<h2 id="case-3">Case 3</h2>

<p>Let’s imagine that you are at your early 20s and just got your first job recently and do not have any savings for now.</p>

<p>From next month on, you will be able to save 500 each month.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Each period is a month
</span>
<span class="c1"># No initial investment
</span><span class="n">initial_investment</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Invest 500 Euro at the end of each month
</span><span class="n">investment_per_period</span> <span class="o">=</span> <span class="mi">500</span>

<span class="c1"># Assuming the average investment return rate is about 5% per year
</span><span class="n">return_per_year</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">return_per_period</span> <span class="o">=</span> <span class="p">(</span><span class="n">return_per_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> 

<span class="c1"># Assuming the plan lasts for 40 years
</span><span class="n">n_years</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">n_period</span> <span class="o">=</span> <span class="n">n_years</span><span class="o">*</span><span class="mi">12</span>

<span class="n">df_plan3</span> <span class="o">=</span> <span class="n">calc_return_over_periods</span><span class="p">(</span><span class="n">initial_investment</span><span class="p">,</span> <span class="n">investment_per_period</span><span class="p">,</span> 
                                   <span class="n">return_per_period</span><span class="p">,</span> <span class="n">n_period</span><span class="p">,</span>
                                   <span class="n">invest_at_period_begin</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">df_plan3</span>
</code></pre></div></div>

<div>
<table style="margin-left:auto;margin-right:auto;width:80%" border="1" class="minimalistBlack">
  <thead>
    <tr>
      <th></th>
      <th>period_begin_investment</th>
      <th>total_investment</th>
      <th>value_by_next_period</th>
      <th>return_by_next_period</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>500.0</td>
      <td>500.0</td>
      <td>502.04</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>500.0</td>
      <td>1000.0</td>
      <td>1006.12</td>
      <td>0.01</td>
    </tr>
    <tr>
      <th>3</th>
      <td>500.0</td>
      <td>1500.0</td>
      <td>1512.26</td>
      <td>0.01</td>
    </tr>
    <tr>
      <th>4</th>
      <td>500.0</td>
      <td>2000.0</td>
      <td>2020.45</td>
      <td>0.01</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>475</th>
      <td>500.0</td>
      <td>237500.0</td>
      <td>726824.57</td>
      <td>2.06</td>
    </tr>
    <tr>
      <th>476</th>
      <td>500.0</td>
      <td>238000.0</td>
      <td>730287.78</td>
      <td>2.07</td>
    </tr>
    <tr>
      <th>477</th>
      <td>500.0</td>
      <td>238500.0</td>
      <td>733765.10</td>
      <td>2.08</td>
    </tr>
    <tr>
      <th>478</th>
      <td>500.0</td>
      <td>239000.0</td>
      <td>737256.59</td>
      <td>2.08</td>
    </tr>
    <tr>
      <th>479</th>
      <td>500.0</td>
      <td>239500.0</td>
      <td>740762.30</td>
      <td>2.09</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_changes</span><span class="p">(</span><span class="n">df_plan3</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">'Case 3'</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target_value</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s">'month'</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/2_output_15_0.png" alt="png" title="Case 3" width="80%" /></p>

<p>Even with little amount of savings, you can still have enough money for your retirement by 60.</p>

<h2 id="conclusion">Conclusion</h2>

<p>We can observe that, in Case 3, the rate of return looks way better than Case 1 and and Case 2. So start investing earlier is always a good idea!</p>

<p>Hope this post is useful for you to set up a long term investment plan :)</p>

<p>Starting from the next post, we are going to do some backtesting using the total return index of SP500.</p>


      </p>
    </div>
    

    

</section>

<section class="post">
  <header class="post-header">
    <p class="post-meta">
      <span class="post-date">
        21 JUL 2019
      </span>
      
      •
      
        <a class="post-cat" href="https://RuoyunLin.github.io/categories/#User Experience">User Experience</a>
        
        <span>/</span>
        
      
        <a class="post-cat" href="https://RuoyunLin.github.io/categories/#Data Science">Data Science</a>
        
      
      
    </p>
    <h1>
      <a href="https://RuoyunLin.github.io/articles/2019-07/surveymonkey-python-analysis" class="post-title" title="Analyze Survey Monkey data using Python">Analyze Survey Monkey data using Python</a>
      
    </h1>

    

    </header>

    
    <div class="post-description">
      <p>
        <h2 id="introduction">Introduction</h2>

<p>Survey Monkey is an online survey software that helps you to create and run online surveys. It is also possible to visualize the survey results in Survey Monkey (for a single survey). However, if we want to compare the <em>same question across several different surveys</em>, it is difficult to do so directly in Survey Monkey. Luckily, we can solve the problem by using programming languages like Python.</p>

<p><img src="/assets/1_1.png" alt="alt_text" title="surveymonkey_visualization" /></p>

<p>The reason why I wrote this blog post is to share knowledge. I am still at the stage of learning python for data analysis. When I first encountered this problem of analyzing survey monkey data in python, I tried to google if there is anyone else who has shared a solution. I failed to find any direct answers on the first page of google. After trials and errors, I finally came up with some tricks and useful functions to solve the problem. Therefore, I want to share my knowledge and python functions which might help others to save some time.</p>

<p>This post will show you how to analyze survey data exported from Survey Monkey from multiple surveys in Python. To be more specific, I will first explain how to import Survey Monkey data into Python and automatically generate a codebook, and then share my code for visualizing the survey results for three types of survey questions:</p>
<ul>
  <li>checkboxes (multi-answer question)</li>
  <li>multiple choice (single-answer question)</li>
  <li>matrix table</li>
</ul>

<p>For all the codes below, I used python 3.7 and the following packages:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#pandas==0.24.2
</span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="c1">#numpy==1.16.2
</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="c1">#seaborn==0.9.0
</span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="c1">#matplotlib==3.0.3
</span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="c1">#set plot style
</span><span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s">'bmh'</span><span class="p">)</span>
</code></pre></div></div>
<p>You can see the complete code for all my analysis in this <a href="https://github.com/RuoyunLin/code_snippets/blob/master/survey_monkey_python_analysis/CodeExamples_ForSurveyMonkeyData.ipynb">notebook</a>.</p>

<h2 id="import-survey-monkey-data-into-python">Import Survey Monkey data into Python</h2>

<h3 id="step-1-export-data-from-survey-monkey">Step 1: Export data from Survey Monkey</h3>

<p>I first created an example survey on Survey Monkey including the aforementioned three types of questions. I also manually created some fake responses in order to demonstrate how the raw data looks like after exporting from Survey Monkey.</p>

<p><img src="/assets/1_2.png" alt="alt_text" title="example_survey" width="60%" /></p>

<p>You can export data from Survey Monkey easily by going to the “Analyze results” tab in a Survey and then click ”Save as”…”All response data”. It is recommended to export the “Actual answer text” so that you do not need to prepare the codebook manually.</p>

<p><img src="/assets/1_3.png" alt="alt_text" title="download_data" /></p>

<p>Please export all the survey data that you want to merge later in Python from Survey Monkey, rename the CSV files inside the zip file, and move them into the working directory.</p>

<h3 id="step-2-import-survey-monkey-data-into-python">Step 2: Import Survey Monkey data into Python</h3>

<p>We can use the pandas package to import the data as a dataframe. Please note the data exported from Survey Monkey actually includes two rows of headers. They can be used as a codebook to better understand the meaning of each column.</p>

<p><img src="/assets/1_4.png" alt="alt_text" title="read_surveymonkey_data_with_header" width="80%" /></p>

<p>As we can see from the screenshot above, the original column names are very complicated. In order to easily refer to each column later in the data analysis process, I decided to replace the header in a dataframe using numerical values with a prefix of “Q”.</p>

<p>In the following screenshot, you can see that I imported two datasets from two surveys that share the same question and merged them into one dataframe.</p>

<p><img src="/assets/1_5.png" alt="alt_text" title="read_surveymonkey_data_without_header" width="80%" /></p>

<h2 id="data-visualization-by-group">Data visualization by group</h2>

<p>In order to demonstrate the use of the following functions, I created more fake data with the python library <a href="https://github.com/joke2k/faker">Faker</a>.</p>

<h3 id="how-to-visualize-the-multi-answer-question-by-group">How to visualize the multi-answer question by group?</h3>

<p><strong>Example code:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Prepare the summary table (please clean the data beforehand)
</span><span class="k">def</span> <span class="nf">prepare_table</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">column_range</span><span class="p">,</span> <span class="n">group_column_name</span><span class="o">=</span><span class="s">'group'</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">col_range_index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">column_range</span><span class="p">)</span>
    <span class="n">group_index</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">group_column_name</span><span class="p">)</span>
    <span class="n">col_range_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_index</span><span class="p">)</span>
    <span class="n">series</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">col_range_index</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">group_column_name</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">(</span><span class="n">series</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="n">group</span><span class="p">]</span> <span class="o">/</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">group_column_name</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[</span><span class="n">group</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="nb">round</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                    <span class="n">codebook</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">:]),</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">group</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">"percentage(</span><span class="si">%</span><span class="s">)"</span><span class="p">,</span> <span class="s">"options"</span><span class="p">,</span> <span class="n">group_column_name</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">res</span><span class="p">)</span>


<span class="c1"># Generate the checkbox chart based on the summary table
</span><span class="k">def</span> <span class="nf">gen_chart_checkbox</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">column_range</span><span class="p">,</span> <span class="n">group_column_name</span><span class="o">=</span><span class="s">'group'</span><span class="p">):</span>
    <span class="n">listOfGroup</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">group_column_name</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
    <span class="n">listOfGroup</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">table_sum</span> <span class="o">=</span> <span class="n">prepare_table</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">column_range</span><span class="p">,</span> <span class="n">group_column_name</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s">"Number of answers in each group: "</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">group_column_name</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s">"percentage(</span><span class="si">%</span><span class="s">)"</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s">"options"</span><span class="p">,</span>
        <span class="n">hue</span><span class="o">=</span><span class="n">group_column_name</span><span class="p">,</span>
        <span class="n">hue_order</span><span class="o">=</span><span class="n">listOfGroup</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">table_sum</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">codebook</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">column_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">"group"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</code></pre></div></div>

<p><strong>Input:</strong></p>

<ul>
  <li>data: Name of the dataframe</li>
  <li>column_range: A list of columns for the multi-answer questions</li>
  <li>group_column_name: The name of the column to identify group in the string format</li>
</ul>

<p><strong>Output:</strong></p>

<p><img src="/assets/1_6.png" alt="alt_text" title="output_checkboxes" width="80%" /></p>

<h3 id="how-to-visualize-the-single-answer-question-by-group">How to visualize the single-answer question by group?</h3>

<p><strong>Example code:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Generate a chart to visualize single-answer questions
</span><span class="k">def</span> <span class="nf">gen_chart_radiobutton</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">question_name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">group_column_name</span><span class="o">=</span><span class="s">'group'</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Number of answers in each group: "</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">question_name</span><span class="p">,</span> <span class="n">group_column_name</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">group_column_name</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
    <span class="n">i_counts</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">group_column_name</span><span class="p">])[</span><span class="n">question_name</span><span class="p">]</span>
        <span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s">"percentage(</span><span class="si">%</span><span class="s">)"</span><span class="p">)</span>
        <span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="o">.</span><span class="nb">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">listOfGroup</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">group_column_name</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
    <span class="n">listOfGroup</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s">"percentage(</span><span class="si">%</span><span class="s">)"</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">question_name</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
        <span class="n">hue</span><span class="o">=</span><span class="n">group_column_name</span><span class="p">,</span>
        <span class="n">hue_order</span><span class="o">=</span><span class="n">listOfGroup</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">i_counts</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">codebook</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">question_name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]),</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">"group"</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><strong>Input:</strong></p>

<ul>
  <li>data: Name of the dataframe</li>
  <li>question_name: Column name of the question</li>
  <li>index: a list of the categorical labels in an order that makes the most sense for understanding the chat</li>
  <li>group_column_name: The name of the column to identify group in the string format</li>
</ul>

<p><strong>Output:</strong></p>

<p><img src="/assets/1_7.png" alt="alt_text" title="output_multi_choice" width="80%" /></p>

<h3 id="how-to-visualize-the-matrix-table-by-group">How to visualize the matrix table by group?</h3>

<p><strong>Example code:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Generate summary data for each group
</span><span class="k">def</span> <span class="nf">gen_table</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">col_range</span><span class="p">,</span> <span class="n">group_column_name</span><span class="o">=</span><span class="s">'group'</span><span class="p">):</span>
    <span class="n">data_sub</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">group_column_name</span><span class="p">]</span> <span class="o">==</span> <span class="n">group_name</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">col_range</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s">"all"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">data_sub</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">data_sub</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_sub</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s">"Strongly agree"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                <span class="s">"Agree"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                <span class="s">"Undecided"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s">"Disagree"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s">"Strongly disagree"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">data_sub</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s">"mean"</span><span class="p">,</span> <span class="s">"std"</span><span class="p">,</span> <span class="s">"count"</span><span class="p">]]</span><span class="o">.</span><span class="n">T</span>

    <span class="n">index</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">codebook</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="n">table</span><span class="p">[</span><span class="s">"item"</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>

    <span class="c1"># table["item_n"] = range(len(index),0,-1)
</span>    <span class="n">table</span><span class="p">[</span><span class="s">"item_n"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">table</span>


<span class="c1"># Generate a chart to compare the importance of missing features across two groups
</span><span class="k">def</span> <span class="nf">compare_importance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">col_range</span><span class="p">,</span> <span class="n">group_column_name</span><span class="o">=</span><span class="s">'group'</span><span class="p">):</span>

    <span class="n">group_name_to_describe_data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1">#Create a dictionary to save the summary data for each group
</span>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">groups</span><span class="p">):</span>
        <span class="n">group_name_to_describe_data</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span> <span class="o">=</span> <span class="s">"data_describe_</span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="n">i</span>

    <span class="k">for</span> <span class="n">group_name</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">gen_table</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">col_range</span><span class="p">,</span> <span class="n">group_column_name</span><span class="p">)</span>
        <span class="n">group_name_to_describe_data</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span>

    <span class="c1">#Get the item list and index
</span>    <span class="n">items</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">item_n</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">item_n</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="c1"># Visualize the mean value with the 95% confidence interval
</span>    <span class="c1"># Change the figsize if you have more yticks
</span>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">"w"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">"k"</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">groups</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
            <span class="n">group_name_to_describe_data</span><span class="p">[</span><span class="n">group_name</span><span class="p">][</span><span class="s">"mean"</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span>
            <span class="n">group_name_to_describe_data</span><span class="p">[</span><span class="n">group_name</span><span class="p">][</span><span class="s">"item_n"</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span>
            <span class="n">xerr</span><span class="o">=</span><span class="mf">1.96</span>
            <span class="o">*</span> <span class="p">(</span>
                <span class="n">group_name_to_describe_data</span><span class="p">[</span><span class="n">group_name</span><span class="p">][</span><span class="s">"std"</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
                <span class="o">/</span> <span class="p">(</span><span class="n">group_name_to_describe_data</span><span class="p">[</span><span class="n">group_name</span><span class="p">][</span><span class="s">"count"</span><span class="p">]</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">fmt</span><span class="o">=</span><span class="s">"o"</span><span class="p">,</span>
            <span class="n">elinewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">capsize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s">"o"</span><span class="p">,</span>
            <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">group_name</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">item_n</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">items</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">'fontsize'</span><span class="p">:</span><span class="mi">16</span><span class="p">})</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">"group"</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Compare the mean values across groups (scale 1-5)"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><strong>Input:</strong></p>

<ul>
  <li>data: Name of the dataframe</li>
  <li>groups: Group names of surveys that you are interested in comparing</li>
  <li>col_range:  A list of columns for the matrix question</li>
  <li>group_column_name: The name of the column to identify group in the string format</li>
</ul>

<p>Note: Here please customize the function of score_to_numeric above in order to convert the text labels in the raw data into meaningful numbers that you can interpret.</p>

<p><strong>Output:</strong></p>

<p><img src="/assets/1_8.png" alt="alt_text" title="output_compare_matrix" width="80%" /></p>

      </p>
    </div>
    

    

</section>


        <footer>
  &copy; 2020 Ruoyun Lin. Powered by <a href="http://octopress.org/">Octopress 3.0</a> and <a href="http://github.com/renyuanz/leonids/">Leonids theme</a>.
</footer>

      </div>
    </div>
  </div>
  <script type="text/javascript" src="https://RuoyunLin.github.io/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="https://RuoyunLin.github.io/js/main.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-141882286-1', 'auto');
  ga('send', 'pageview');
</script>



</body>
</html>
